<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Journal</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Trading Journal</h1>

        <div class="main-controls">
            <div class="journals-section">
                <h2>Journals</h2>
                <select id="journal-select">
                    <option value="">-- Journal auswählen --</option>
                </select>
                <button id="add-journal-btn">Neues Journal</button>
                <button id="manage-checklist-btn" style="display: none;">Checkliste verwalten</button>
                <button id="view-stats-btn" style="display: none;">Statistiken anzeigen</button> <!-- Added Stats Button -->
            </div>
        </div>

        <div class="entries-section" style="display: none;">
            <h2 id="current-journal-name">Einträge</h2>
            <button id="add-entry-btn">Neuer Eintrag</button>
            <div id="entries-list"></div>
        </div>

        <!-- Modal/Form for Adding/Editing Journal -->
        <div id="journal-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn" onclick="closeModal('journal-modal')">&times;</span>
                <h3 id="journal-modal-title">Neues Journal erstellen</h3>
                <input type="hidden" id="journal-edit-id">
                <label for="journal-name">Name:</label>
                <input type="text" id="journal-name" required>
                <label for="journal-description">Beschreibung:</label>
                <textarea id="journal-description"></textarea>
                <label for="journal-has-sl-tp">SL/TP Felder anzeigen?</label>
                <input type="checkbox" id="journal-has-sl-tp">

                <!-- Neues benutzerdefiniertes Feld -->
                <label for="journal-has-custom-field">Benutzerdefiniertes Feld anzeigen?</label>
                <input type="checkbox" id="journal-has-custom-field">
                <div id="custom-field-options" style="display: none;">
                    <label for="journal-custom-field-name">Feldname:</label>
                    <input type="text" id="journal-custom-field-name" placeholder="z.B. Marktphase, Zeitrahmen, etc.">
                    <label for="journal-custom-field-options">Optionen (eine pro Zeile):</label>
                    <textarea id="journal-custom-field-options" rows="3" placeholder="Option 1&#10;Option 2&#10;Option 3"></textarea>
                </div>

                <h4>Standard Checklistenpunkte (einer pro Zeile):</h4>
                <textarea id="journal-checklist-templates" rows="5" placeholder="Trade mit dem Gesamttrend?
Trade mit dem 15-Minuten-Trend?
..."></textarea>
                <button id="save-journal-btn">Speichern</button>
                <button id="delete-journal-btn" style="display: none; background-color: red;">Journal löschen</button>
            </div>
        </div>

        <!-- Modal/Form for Managing Checklist Templates -->
        <div id="checklist-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn" onclick="closeModal('checklist-modal')">&times;</span>
                <h3>Checkliste für <span id="checklist-journal-name"></span> verwalten</h3>
                <ul id="checklist-template-list"></ul>
                <div>
                    <input type="text" id="new-checklist-item-text" placeholder="Neuer Checklistenpunkt">
                    <button id="add-checklist-item-btn">Hinzufügen</button>
                </div>
            </div>
        </div>

        <!-- Modal/Form for Adding/Editing Entry -->
        <div id="entry-modal" class="modal">
            <div class="modal-content large">
                <span class="close-btn" onclick="closeModal('entry-modal')">&times;</span>
                <h3 id="entry-modal-title">Neuer Eintrag</h3>
                <input type="hidden" id="entry-edit-id">
                <input type="hidden" id="entry-journal-id">

                <div class="form-grid">
                    <!-- Left Column: Core Trade Details -->
                    <div>
                        <label for="entry-date">Datum:</label>
                        <input type="datetime-local" id="entry-date">

                        <label for="entry-symbol">Symbol:</label> <!-- New -->
                        <input type="text" id="entry-symbol" placeholder="z.B. NQ1!, AAPL">

                        <label for="entry-position-type">Position:</label> <!-- New -->
                        <select id="entry-position-type">
                            <option value="">-- Auswählen --</option>
                            <option value="Long">Long</option>
                            <option value="Short">Short</option>
                        </select>

                        <label for="entry-strategy">Strategie:</label> <!-- Dropdown statt Textfeld -->
                        <div class="strategy-input">
                            <select id="entry-strategy-select">
                                <option value="">-- Auswählen --</option>
                                <!-- Optionen werden dynamisch geladen -->
                            </select>
                            <button type="button" id="add-new-strategy-btn">+</button>
                        </div>

                        <label for="entry-initial-rr">Initial R/R:
                            <span class="info-tooltip" title="Risk/Reward Ratio zu Beginn des Trades (z.B. 1.5 für 1:1.5)">ⓘ</span>
                        </label> <!-- New with Tooltip -->
                        <input type="number" step="0.1" id="entry-initial-rr" placeholder="z.B. 1.5">

                        <label for="entry-pnl">P&L:</label>
                        <input type="number" step="any" id="entry-pnl">

                        <label for="entry-result">Ergebnis:</label>
                        <select id="entry-result">
                            <option value="">-- Auswählen --</option>
                            <option value="Win">Win</option>
                            <option value="Loss">Loss</option>
                            <option value="BE">BE</option>
                            <option value="PartialBE">Partial BE</option>
                        </select>

                        <div id="sl-tp-fields" style="display: none;">
                            <label for="entry-sl">Stop Loss:</label>
                            <input type="number" step="any" id="entry-sl">
                            <label for="entry-tp">Take Profit:</label>
                            <input type="number" step="any" id="entry-tp">
                        </div>

                        <!-- Neues benutzerdefiniertes Feld -->
                        <div id="custom-field" style="display: none;">
                            <label for="entry-custom-field" id="custom-field-label">Benutzerdefiniertes Feld:</label>
                            <select id="entry-custom-field">
                                <option value="">-- Auswählen --</option>
                                <!-- Optionen werden dynamisch geladen -->
                            </select>
                        </div>

                        <label for="entry-confidence">Konfidenzniveau:</label>
                        <input type="range" id="entry-confidence" min="1" max="100" value="50">
                        <span id="confidence-value">50</span>

                        <label>Handelsbewertung:</label>
                        <div class="star-rating">
                            <input type="number" id="entry-rating" min="1" max="5" step="0.1" value="3.0" style="display: none;">
                            <div id="stars-display"></div>
                        </div>

                        <label for="entry-notes">Notizen:</label>
                        <textarea id="entry-notes" rows="4"></textarea>
                    </div>

                    <!-- Right Column: Checklist & Images -->
                    <div>
                        <h4>Checkliste:</h4>
                        <div id="entry-checklist"></div>

                        <h4>Screenshots:</h4>
                        <div class="image-upload-area">
                            <label for="entry-image-category">Kategorie:</label>
                            <select id="entry-image-category">
                                <option value="Before">Vorher</option>
                                <option value="After">Nachher</option>
                            </select>
                            <label for="entry-image-upload" class="upload-btn-wrapper">
                                <button type="button" class="btn">Screenshot hinzufügen</button>
                                <input type="file" id="entry-image-upload" accept="image/*">
                            </label>
                            <span id="upload-status"></span>
                        </div>
                        <h5>Vorher:</h5>
                        <div id="entry-images-preview-before" class="image-preview-section"></div>
                        <h5>Nachher:</h5>
                        <div id="entry-images-preview-after" class="image-preview-section"></div>
                    </div>
                </div>

                <button id="save-entry-btn">Eintrag Speichern</button>
                <button id="delete-entry-btn" style="display: none; background-color: red;">Eintrag löschen</button>
            </div>
        </div>

        <!-- Neues Modal für neue Strategie hinzufügen -->
        <div id="strategy-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn" onclick="closeModal('strategy-modal')">&times;</span>
                <h3>Neue Strategie hinzufügen</h3>
                <label for="new-strategy-name">Name der Strategie:</label>
                <input type="text" id="new-strategy-name">
                <button id="save-strategy-btn">Strategie speichern</button>
            </div>
        </div>

        <!-- Statistics Modal -->
        <div id="stats-modal" class="modal">
            <div class="modal-content large">
                <span class="close-btn" onclick="closeModal('stats-modal')">&times;</span>
                <h3>Statistiken für <span id="stats-journal-name"></span></h3>
                <div id="stats-content">
                    <!-- Statistics will be loaded here -->
                    <p>Statistiken werden geladen...</p>
                </div>
            </div>
        </div>

        <!-- Lightbox Modal -->
        <div id="lightbox-modal" class="modal lightbox">
            <span class="close-btn lightbox-close" onclick="closeModal('lightbox-modal')">&times;</span>
            <img class="lightbox-content" id="lightbox-img">
            <div id="lightbox-caption"></div>
        </div>

    </div>

    <script src="script.js"></script>
</body>
</html>